
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Prepare RQA Data &#8212; LocalRQA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'modules/data/data_preparation';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Training" href="../training.html" />
    <link rel="prev" title="RQA Data Format" href="data_description.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">LocalRQA  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/quickstart.html">Quickstart</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../data.html">Data</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="data_description.html">RQA Data Format</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Prepare RQA Data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../training.html">Training</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../training/retriever.html">Training a Retriever</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../training/retriever/ctl.html">Contrastive Learning (CTL)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../training/retriever/dca.html">Distill from Cross-Attention scores (DCA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../training/retriever/rpg.html">Distill from an LM’s probability distribution (RPG)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../training/generator.html">Training a Generator</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../training/generator/sft.html">SFT with Gold Data (SFT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../training/generator/swr.html">SFT with a Frozen Retriever (SwR)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../training/generator/fid.html">Fusion-in-Decoder Training (FiD)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../evaluation.html">Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../evaluation/eval_retriever.html">Retriever Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluation/eval_e2e.html">End-to-End Evaluation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../serving.html">Serving</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../serving/human_eval.html">Static Human Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serving/interactive.html">Interactive Chat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serving/acc_frameworks.html">Inference Acceleration Frameworks</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Playground</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../playground/custom_rqa.html">Customize your RQA system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playground/custom_trainer.html">Customize Model Trainers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../usecases/databricks.html">Databricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/faire.html">Faire</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api_reference/local_rqa.html">local_rqa namespace</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.evaluation.html">local_rqa.evaluation package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.guardrails.html">local_rqa.guardrails package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.pipelines.html">local_rqa.pipelines package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.qa_llms.html">local_rqa.qa_llms package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.retrievers.html">local_rqa.retrievers package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.schema.html">local_rqa.schema package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.serve.html">local_rqa.serve package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/local_rqa.text_loaders.html">local_rqa.text_loaders package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api_reference/local_rqa.trainers.html">local_rqa.trainers namespace</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api_reference/local_rqa.trainers.qa_llm.html">local_rqa.trainers.qa_llm namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api_reference/local_rqa.trainers.retriever.html">local_rqa.trainers.retriever namespace</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/modules/data/data_preparation.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Prepare RQA Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-data-from-scratch">Prepare Data from Scratch</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-document-pickle-file">Prepare Document Pickle File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-questions">Generate Questions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-answers">Generate Answers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-from-existing-datasets">Convert from Existing Datasets</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="prepare-rqa-data">
<span id="data-preparation"></span><h1>Prepare RQA Data<a class="headerlink" href="#prepare-rqa-data" title="Link to this heading">#</a></h1>
<p>To use all components of LocalRQA effortlessly, you need to prepare two types of data: 1) a <strong>document database</strong>, and 2) a <strong>collection of question-passage pairs or question-passage-answer triplets</strong>. In general, we provide two methods to obtain these data:</p>
<ul class="simple">
<li><p><strong>Create your own data from scratch</strong>: starting from your own data source (supported by <code class="docutils literal notranslate"><span class="pre">langchain</span></code> or <code class="docutils literal notranslate"><span class="pre">llama-index</span></code>), you can create question-passage-answer using our sampling algorithm and an LLM.</p></li>
<li><p><strong>Convert from existing QA datasets</strong>: many existing QA datasets, such as Natural Questions, TriviaQA, and MS-Marco, contain question-passage-answer triplets. We can directly convert these datasets into the format used by LocalRQA.</p></li>
</ul>
<section id="prepare-data-from-scratch">
<h2>Prepare Data from Scratch<a class="headerlink" href="#prepare-data-from-scratch" title="Link to this heading">#</a></h2>
<p>The following steps present a high-level overview of how to prepare RQA data from scratch. For more concrete examples, please refer to our tutorial with <a class="reference internal" href="../../usecases/databricks.html#use-case-databricks"><span class="std std-ref">Databricks</span></a> and <a class="reference internal" href="../../usecases/faire.html#use-case-faire"><span class="std std-ref">Faire</span></a>!</p>
<section id="prepare-document-pickle-file">
<h3>Prepare Document Pickle File<a class="headerlink" href="#prepare-document-pickle-file" title="Link to this heading">#</a></h3>
<p>LocalRQA supports integration with frameworks such as LangChain and LlamaIndex to easily ingest text data in various formats, such as JSON data, HTML data, data from Google Drive, etc.
In the <a class="reference internal" href="../../getting_started/quickstart.html#quickstart"><span class="std std-ref">Quickstart</span></a>, it shows an example of parsing and storing the website content with URLs as data source, here is another example of using JSONL format data as source.</p>
<p>Here is an sample of JSONL data format, where “text” key must be used to store the passage content. While, other keys (such as “source”, “title”, etc.) are optional:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;source&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;passage_source&gt;&quot;</span>,
<span class="w">    </span><span class="s2">&quot;title&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;passage_title&gt;&quot;</span>,
<span class="w">    </span><span class="s2">&quot;text&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;passage_content&gt;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Then run the following command,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>scripts/data/process_docs.py<span class="w"> </span><span class="se">\</span>
--document_path<span class="w"> </span>&lt;example/docs.jsonl&gt;<span class="w"> </span><span class="se">\</span>
--model_name_or_path<span class="w"> </span>facebook/contriever-msmarco<span class="w"> </span><span class="se">\</span>
--chunk_size<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="se">\</span>
--chunk_overlap_size<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="se">\</span>
--save_dir<span class="w"> </span>example<span class="w"> </span><span class="se">\</span>
--save_name<span class="w"> </span>documents
</pre></div>
</div>
<p>It will:</p>
<ul class="simple">
<li><p>load jsonl file from <code class="docutils literal notranslate"><span class="pre">&lt;example/docs.jsonl&gt;</span></code></p></li>
<li><p>split the text by <strong>RecursiveCharacterTextSplitter.from_huggingface_tokenizer</strong> based on the chunk size measured by <strong>facebook/contriever-msmarco</strong> tokenizer</p></li>
<li><p>represent the documents with a list of Document object and save into <code class="docutils literal notranslate"><span class="pre">&lt;example/documents.pkl&gt;</span></code> file</p></li>
</ul>
<p>Here is a sample of pickle file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>
<span class="w">    </span>Document<span class="o">(</span>
<span class="w">        </span><span class="nv">page_content</span><span class="o">=</span><span class="s1">&#39;&lt;passage_content&gt;&#39;</span>,
<span class="w">        </span><span class="nv">fmt_content</span><span class="o">=</span><span class="s1">&#39;Source: &lt;passage_source&gt;\nTitle: &lt;passage_title&gt;\nContent:\n&lt;passage_content&gt;&#39;</span>,
<span class="w">        </span><span class="nv">metadata</span><span class="o">={</span><span class="s1">&#39;source&#39;</span>:<span class="w"> </span><span class="s1">&#39;&lt;passage_source&gt;&#39;</span>,<span class="w"> </span><span class="s1">&#39;seq_num&#39;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s1">&#39;title&#39;</span>:<span class="w"> </span><span class="s1">&#39;&lt;passage_title&gt;&#39;</span><span class="o">}</span>
<span class="w">    </span><span class="o">)</span>
<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="generate-questions">
<h3>Generate Questions<a class="headerlink" href="#generate-questions" title="Link to this heading">#</a></h3>
<p>By using the prepared <code class="docutils literal notranslate"><span class="pre">&lt;example/documents.pkl&gt;</span></code> file, run the following script to generate questions with the help of LLM, such as gpt-3.5-turbo.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>scripts/data/doc_to_q.py<span class="w"> </span><span class="se">\</span>
-mode<span class="w"> </span>all<span class="w"> </span><span class="se">\</span>
-document_path<span class="w"> </span>&lt;example/documents.pkl&gt;<span class="w"> </span><span class="se">\</span>
--prompt_model<span class="w"> </span>gpt-3.5-turbo<span class="w"> </span><span class="se">\</span>
--num_hard_negs_per_doc<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
--num_train_data<span class="w"> </span><span class="m">600</span><span class="w"> </span><span class="se">\</span>
--num_eval_test_data<span class="w"> </span><span class="m">150</span><span class="w"> </span><span class="se">\</span>
--save_dir<span class="w"> </span>&lt;example&gt;
</pre></div>
</div>
<p>It will save <strong>eval_w_q.jsonl, test_w_q.jsonl, train_w_q.jsonl</strong> into the <code class="docutils literal notranslate"><span class="pre">&lt;example&gt;</span></code> directory.</p>
</section>
<section id="generate-answers">
<h3>Generate Answers<a class="headerlink" href="#generate-answers" title="Link to this heading">#</a></h3>
<p>Then, with the prepared <strong>eval_w_q.jsonl, test_w_q.jsonl, train_w_q.jsonl</strong> from the previous step, we will leverage on the LLM (such as OPENAI gpt-4-1106-preview model) again to generate the corresponding answer. Here is an example to generate <strong>train_w_qa.jsonl</strong> by using <strong>train_w_q.jsonl</strong> file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>scripts/data/doc_q_to_a.py<span class="w"> </span><span class="se">\</span>
--prompt_model<span class="w"> </span>gpt-4-1106-preview<span class="w"> </span><span class="se">\</span>
--dataset_w_q<span class="w"> </span>&lt;example/train_w_q.jsonl&gt;<span class="w"> </span><span class="se">\</span>
--save_name<span class="w"> </span>train_w_qa.jsonl<span class="w"> </span><span class="se">\</span>
--save_dir<span class="w"> </span>&lt;example&gt;<span class="w"> </span><span class="se">\</span>
--end_data_idx<span class="w"> </span><span class="m">4</span><span class="w">  </span><span class="c1"># a small number to test if it works</span>
</pre></div>
</div>
</section>
</section>
<section id="convert-from-existing-datasets">
<h2>Convert from Existing Datasets<a class="headerlink" href="#convert-from-existing-datasets" title="Link to this heading">#</a></h2>
<p>QA datasets such as Natural Questions (Kwiatkowski et al., 2019), TriviaQA (Joshi et al., 2017), and MS-Marco (Bajaj et al., 2018) implicitly contain question-passage-answer triplets. We provide scripts that can convert these datasets into the format used by LocalRQA.</p>
<p>For example, to convert the TriviaQA dataset:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>scripts/data/load_hf_data.py<span class="w"> </span><span class="se">\</span>
--dataset<span class="w"> </span>trivial_qa<span class="w"> </span><span class="se">\</span>
--document_save_path<span class="w"> </span>&lt;example/trivial_qa/documents&gt;<span class="w"> </span><span class="se">\</span>
--train_data_save_path<span class="w"> </span>&lt;example/trivial_qa/training_data&gt;
</pre></div>
</div>
<p>this will:</p>
<ul class="simple">
<li><p>store all the documents in the TrivialQA dataset as a document database under the <code class="docutils literal notranslate"><span class="pre">example/trivial_qa/documents</span></code> directory</p></li>
<li><p>split the training, validation, and test data as <code class="docutils literal notranslate"><span class="pre">train_w_qa.jsonl</span></code>, <code class="docutils literal notranslate"><span class="pre">eval_w_qa.jsonl</span></code>, and <code class="docutils literal notranslate"><span class="pre">test_w_qa.jsonl</span></code>, and store them under the <code class="docutils literal notranslate"><span class="pre">example/trivial_qa/training_data</span></code> directory.</p></li>
</ul>
<p>These converted data contain <strong>everything</strong> you need to run LocalRQA’s training, evaluation, and serving components. For all currently supported datasets, run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">scripts/data/load_hf_data.py</span> <span class="pre">-h</span></code>.</p>
<p><strong>References</strong></p>
<ul class="simple">
<li><p>Tom Kwiatkowski, Jennimaria Palomaki, Olivia Redfield, Michael Collins, Ankur Parikh, Chris Alberti, Danielle Epstein, Illia Polosukhin, Jacob Devlin, Kenton Lee, Kristina Toutanova, Llion Jones, Matthew Kelcey, Ming-Wei Chang, Andrew M. Dai, Jakob Uszkoreit, Quoc Le, and Slav Petrov. 2019. Natural Questions: a benchmark for question answering research. Transactions of the Association for Computational Linguistics, 7:452–466.</p></li>
<li><p>Mandar Joshi, Eunsol Choi, Daniel Weld, and Luke Zettlemoyer. 2017. TriviaQA: A large scale distantly supervised challenge dataset for reading comprehension. In Proceedings of the 55th Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers), pages 1601–1611, Vancouver, Canada. Association for Computational Linguistics</p></li>
<li><p>Payal Bajaj, Daniel Campos, Nick Craswell, Li Deng, Jianfeng Gao, Xiaodong Liu, Rangan Majumder, Andrew McNamara, Bhaskar Mitra, Tri Nguyen, Mir Rosenberg, Xia Song, Alina Stoica, Saurabh Tiwary, and Tong Wang. 2018. MS-Marco: A human generated machine reading comprehension dataset.</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="data_description.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">RQA Data Format</p>
      </div>
    </a>
    <a class="right-next"
       href="../training.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Training</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-data-from-scratch">Prepare Data from Scratch</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-document-pickle-file">Prepare Document Pickle File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-questions">Generate Questions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-answers">Generate Answers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-from-existing-datasets">Convert from Existing Datasets</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Xiao Yu, Yunan Lu
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Xiao Yu, Yunan Lu.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>